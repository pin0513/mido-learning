# Spec: ADMIN-003 ä½¿ç”¨è€…åˆ—è¡¨èˆ‡è§’è‰²ç®¡ç†

**Date**: 2026-01-31
**Author**: PM
**Feature ID**: ADMIN-003
**Priority**: P1 (ç¬¬ä¸€æ³¢)
**Depends On**: ADMIN-001 âœ… (å·²å®Œæˆ)

---

## Background

ç®¡ç†å“¡éœ€è¦æŸ¥çœ‹æ‰€æœ‰ä½¿ç”¨è€…åˆ—è¡¨ï¼Œä¸¦èƒ½ç®¡ç†ä½¿ç”¨è€…è§’è‰²ï¼ˆå­¸ç”Ÿ/è€å¸«/ç®¡ç†å“¡ï¼‰ã€‚é€™æ˜¯è§’è‰²ç³»çµ±çš„æ ¸å¿ƒç®¡ç†ä»‹é¢ã€‚

---

## User Stories

- As an **Admin**, I want æŸ¥çœ‹æ‰€æœ‰ä½¿ç”¨è€…åˆ—è¡¨, so that æˆ‘å¯ä»¥äº†è§£å¹³å°ç”¨æˆ¶ç‹€æ³
- As an **Admin**, I want æœå°‹ç‰¹å®šä½¿ç”¨è€…, so that å¿«é€Ÿæ‰¾åˆ°ç›®æ¨™ç”¨æˆ¶
- As an **Admin**, I want ä¿®æ”¹ä½¿ç”¨è€…è§’è‰², so that å¯ä»¥æˆæ¬Šè€å¸«å»ºç«‹æ•™æ

---

## Acceptance Criteria

### å‰ç«¯
- [ ] è·¯ç”±: `/admin/users`
- [ ] é¡¯ç¤ºä½¿ç”¨è€…è¡¨æ ¼ (Email, è§’è‰², å»ºç«‹æ™‚é–“, æœ€å¾Œç™»å…¥)
- [ ] æ”¯æ´åˆ†é  (æ¯é  20 ç­†)
- [ ] å¯ä¾è§’è‰²ç¯©é¸ (å…¨éƒ¨/å­¸ç”Ÿ/è€å¸«/ç®¡ç†å“¡)
- [ ] å¯æœå°‹ä½¿ç”¨è€… (by Email)
- [ ] è§’è‰²ä¸‹æ‹‰é¸å–®å¯åˆ‡æ› (student/teacher/admin)
- [ ] ä¿®æ”¹è§’è‰²å¾Œå³æ™‚æ›´æ–°é¡¯ç¤º
- [ ] RWD: æ‰‹æ©Ÿç‰ˆè¡¨æ ¼å¯æ©«å‘æ»¾å‹•

### å¾Œç«¯
- [ ] `GET /api/admin/users` å›å‚³ä½¿ç”¨è€…åˆ—è¡¨
- [ ] `PATCH /api/admin/users/{uid}/role` æ›´æ–°è§’è‰²
- [ ] å…©å€‹ API éƒ½éœ€è¦ admin æ¬Šé™

---

## API Specification

### GET /api/admin/users
```http
GET /api/admin/users?page=1&limit=20&role=teacher&search=@gmail
Authorization: Bearer <admin-token>
```

**Response:**
```json
{
  "success": true,
  "data": {
    "users": [
      {
        "uid": "abc123",
        "email": "teacher@gmail.com",
        "displayName": "ç‹è€å¸«",
        "role": "teacher",
        "createdAt": "2026-01-30T10:00:00Z",
        "lastLoginAt": "2026-01-31T08:30:00Z"
      }
    ],
    "total": 150,
    "page": 1,
    "limit": 20
  }
}
```

### PATCH /api/admin/users/{uid}/role
```http
PATCH /api/admin/users/abc123/role
Authorization: Bearer <admin-token>
Content-Type: application/json

{
  "role": "teacher"
}
```

**Response:**
```json
{
  "success": true,
  "message": "ä½¿ç”¨è€…è§’è‰²å·²æ›´æ–°ç‚º teacher"
}
```

---

## UI Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½¿ç”¨è€…ç®¡ç†                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¯©é¸: [å…¨éƒ¨ â–¼]  æœå°‹: [________________] [ğŸ”]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Email              â”‚ è§’è‰²      â”‚ å»ºç«‹æ™‚é–“   â”‚ æœ€å¾Œç™»å…¥    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  admin@mido.com     â”‚ [admin â–¼] â”‚ 2026-01-30 â”‚ 2 å°æ™‚å‰    â”‚
â”‚  teacher@gmail.com  â”‚ [teacherâ–¼]â”‚ 2026-01-30 â”‚ 1 å¤©å‰      â”‚
â”‚  student@yahoo.com  â”‚ [studentâ–¼]â”‚ 2026-01-31 â”‚ 5 åˆ†é˜å‰    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¡¯ç¤º 1-20 / å…± 150 ç­†              [ < ] [ 1 ] [ 2 ] [ > ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technical Spec

### å‰ç«¯æª”æ¡ˆ
```
frontend/app/(admin)/admin/users/page.tsx    # é é¢
frontend/components/admin/UserTable.tsx      # è¡¨æ ¼å…ƒä»¶
frontend/components/admin/RoleSelect.tsx     # è§’è‰²ä¸‹æ‹‰é¸å–®
```

### å¾Œç«¯æª”æ¡ˆ
```
backend/MidoLearning.Api/Endpoints/AdminEndpoints.cs  # æ“´å……
```

### è§’è‰²æ›´æ–°é‚è¼¯
1. æ›´æ–° Firestore `users/{uid}` çš„ `role` æ¬„ä½
2. ä½¿ç”¨ Firebase Admin SDK æ›´æ–° Custom Claims
3. ç”¨æˆ¶ä¸‹æ¬¡ç™»å…¥æ™‚æœƒæ‹¿åˆ°æ–°çš„ token

---

## Out of Scope

- âŒ ä½¿ç”¨è€…è©³æƒ…é 
- âŒ æ‰¹æ¬¡è§’è‰²æ›´æ–°
- âŒ ä½¿ç”¨è€…åœç”¨/åˆªé™¤

---

## Definition of Done

1. [ ] å‰ç«¯é é¢é–‹ç™¼å®Œæˆ
2. [ ] å¾Œç«¯ API é–‹ç™¼å®Œæˆ
3. [ ] åˆ†é åŠŸèƒ½æ¸¬è©¦é€šé
4. [ ] è§’è‰²æ›´æ–°åŠŸèƒ½æ¸¬è©¦é€šé
5. [ ] RWD æ¸¬è©¦é€šé
6. [ ] å‰å¾Œç«¯æ•´åˆæ¸¬è©¦é€šé
