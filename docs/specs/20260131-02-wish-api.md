# Spec: WISH-002 願望儲存 API

**Date**: 2026-01-31
**Author**: PM
**Feature ID**: WISH-002
**Priority**: P1 (第一波)
**Depends On**: WISH-001

---

## Background

配合首頁許願介面，後端需要提供 API 來儲存訪客提交的學習願望。此 API 為公開 API，不需要登入即可使用。

---

## User Stories

- As a **系統**, I want 儲存訪客的學習願望, so that 管理員可以分析市場需求
- As a **訪客**, I want 提交後收到確認, so that 我知道願望已被收到

---

## Acceptance Criteria

- [ ] `POST /api/wishes` 可接收願望內容
- [ ] 不需要 Authorization header (公開 API)
- [ ] 驗證 content 必填，最多 500 字
- [ ] email 選填，若填寫需驗證格式
- [ ] 儲存至 Firestore `wishes` collection
- [ ] 回傳 wishId 與成功訊息
- [ ] Rate limiting: 同 IP 每分鐘最多 5 次

---

## API Specification

### Request
```http
POST /api/wishes
Content-Type: application/json

{
  "content": "我想學習 Python 程式設計",
  "email": "user@example.com"  // optional
}
```

### Response (Success)
```json
{
  "success": true,
  "data": {
    "wishId": "abc123"
  },
  "message": "願望已收到！"
}
```

### Response (Validation Error)
```json
{
  "success": false,
  "message": "願望內容不可超過 500 字"
}
```

### Response (Rate Limit)
```json
{
  "success": false,
  "message": "請求過於頻繁，請稍後再試"
}
```

---

## Data Model

### Firestore: `wishes/{wishId}`
```typescript
{
  content: string,           // 願望內容
  email: string | null,      // 選填 Email
  status: "pending",         // 狀態: pending | reviewed | archived
  ipAddress: string,         // 提交者 IP (for rate limiting & analytics)
  userAgent: string,         // 瀏覽器資訊
  createdAt: Timestamp,      // 提交時間
  reviewedAt: Timestamp | null,
  reviewedBy: string | null
}
```

---

## Technical Spec

### 後端檔案
```
backend/MidoLearning.Api/
├── Endpoints/WishEndpoints.cs      # API endpoints
├── Models/Wish.cs                  # Wish model
└── Services/WishService.cs         # Business logic (optional)
```

### Rate Limiting
使用 in-memory cache 追蹤 IP 請求次數，或使用 ASP.NET Core 的 Rate Limiting middleware。

---

## Out of Scope

- ❌ Admin 願望列表 (見 WISH-003)
- ❌ 願望狀態更新 API (見 WISH-003)
- ❌ 願望分析 (見 WISH-004)

---

## Definition of Done

1. [ ] API endpoint 實作完成
2. [ ] Firestore 資料正確儲存
3. [ ] Rate limiting 測試通過
4. [ ] 後端 build 成功
5. [ ] 整合測試: 前端可成功呼叫
